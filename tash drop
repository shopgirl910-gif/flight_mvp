[1mdiff --git a/.firebase/hosting.YnVpbGRcd2Vi.cache b/.firebase/hosting.YnVpbGRcd2Vi.cache[m
[1mindex 4da5acb..d799f93 100644[m
[1m--- a/.firebase/hosting.YnVpbGRcd2Vi.cache[m
[1m+++ b/.firebase/hosting.YnVpbGRcd2Vi.cache[m
[36m@@ -1,32 +1,32 @@[m
[31m-manifest.json,1764742602535,0b4c0ba1506771a9f4d2876db8bdb63380c79d012441181eeee56057ec910fba[m
[31m-flutter.js,1764739307104,970356511bee637e57348b9e01b3218a3d1d6c4add478fdc306033b4b3e21ef4[m
[31m-favicon.png,1764739440035,19880e004e8357a51f6a64f5d1fdc8828a6432fe9c781f8acb6b730eced2cd13[m
[31m-icons/Icon-maskable-512.png,1764742547277,ea58e5c49bc4dcdc5db0a9fe2f25b2a3152f85ef9094f0d020de0aa318451a1d[m
[31m-icons/Icon-maskable-192.png,1764742547280,f7ac56197638aec92f195c5344d15395c2cbf8a5ae74e846c5b4156b64f05e38[m
[31m-icons/Icon-512.png,1764739440058,1de493563deb283e6ad70f0d5a89cfd61e37343df3b919c9862c5a41699ac5bc[m
[31m-icons/Icon-192.png,1764739440054,5fd961c51d8eb53baacac01f8e53743a76f66a43390a11f5df042e8c618ad64a[m
[31m-canvaskit/skwasm_heavy.wasm,1764739306902,aa021afcfd815b925d5bad0debf468bef50192c458573e4570d6da4e12c2e186[m
[31m-canvaskit/skwasm_heavy.js.symbols,1764739306793,1259742821cf62bece358301f311840038fc2a0352b0c5827f8d2137d6197d08[m
[31m-canvaskit/skwasm_heavy.js,1764739306770,2e3aab5e61c0276a6704938362b4b3a4dc32bbb6d17d601e975e7ed03897b224[m
[31m-canvaskit/skwasm.wasm,1764739306763,4776f3bfb61a7534e2260954b88b177c11a7c73644cd536c47fcaabe5d7dc79b[m
[31m-canvaskit/skwasm.js.symbols,1764739306689,5d3dd3374664b262880564a3e59d64b150f4c632248fb93f913b4eebdeffca83[m
[31m-canvaskit/skwasm.js,1764739306667,6f325d22924e678a9417a777104985babcee8f99080bf90855f26bfa9829a5ea[m
[31m-canvaskit/canvaskit.wasm,1764739306659,ac942f1920618b74351bc74bf1cf4ca078bde56e11692c0bd611e906bfc2d279[m
[31m-canvaskit/canvaskit.js.symbols,1764739306525,b1e22d35cbc9e3b4b89516a8462c9f1f73d86e6debc790833396dff78ad698a7[m
[31m-canvaskit/canvaskit.js,1764739306505,777116800268972381a4832500bb0aafd96ab2546075bd4d96a9025feb5c7555[m
[31m-canvaskit/chromium/canvaskit.wasm,1764739307087,06f70f0703803c7329be30338b79530564ddc1ab2c3789d608431697a9a30ba2[m
[31m-canvaskit/chromium/canvaskit.js.symbols,1764739306935,4a8d181b0622d7a4b4254deb591c43f48dd89623c621dec6f84d0a0b2b8f77a7[m
[31m-canvaskit/chromium/canvaskit.js,1764739306916,e0f423bfd63202fb53a4dd5cffe330143bfb9eabf5e4e8198bb605442a49d3e7[m
[31m-version.json,1765970415492,e5bb603b44dfc7121a8268c2f03be41315b8e8e094abbe54107d13c5bc766067[m
[31m-index.html,1765970338838,294f81b422409857a226901186e9cc80d6b1656dab850d4d653bb153e4567f69[m
[31m-flutter_service_worker.js,1765970424032,86e84ad53c247bab95fc8e03eb29fb3730e66481e2e3008beb6dfdb99a8b3a21[m
[31m-flutter_bootstrap.js,1765970338782,aa19ad04493310550afe96a77d8726760dcb456901a7ef1b6fec45d332a75da2[m
[31m-assets/FontManifest.json,1765970415733,e38b95988f5d060cf9b7ce97cb5ac9236d6f4cc04a11d69567df97b2b4cbc5e5[m
[31m-assets/AssetManifest.bin.json,1765970415733,6763aaa55146ec9534c671aaf5a6db93265eaaa8082767ea02eb2ac9b09cbdaa[m
[31m-assets/AssetManifest.bin,1765970415733,93e425eb6f3c87a588cd708f748fc5bb80fa28bf34c6d814b2bd76daa6a6ed27[m
[31m-assets/shaders/stretch_effect.frag,1765970416146,586ff23669838dd33070077916f0b971a8800f67093ae8d6eed47e6cea50926f[m
[31m-assets/shaders/ink_sparkle.frag,1765970416167,591c7517d5cb43eb91ea451e0d3f9f585cbf8298cf6c46a9144b77cb0775a406[m
[31m-assets/fonts/MaterialIcons-Regular.otf,1765970419778,a2e421fd4c961e4347e63779427160ca42c7a2f529585cd5889ac3b4b86396f7[m
[31m-assets/packages/cupertino_icons/assets/CupertinoIcons.ttf,1765970419770,d41473de1f7708a0702d7f19327693486512db442f6ab0cf7774e6d6576f9fcb[m
[31m-assets/NOTICES,1765970415735,50da8c29c8b28810b906496c29f9dc6755ae57dcfca7061fce8f2318c625a908[m
[31m-main.dart.js,1765970388133,d3f3403cccebaa269af5d59cd0cfda63ab9c290b5833545209cfa0609fbb7107[m
[32m+[m[32mmanifest.json,1765512246632,0b4c0ba1506771a9f4d2876db8bdb63380c79d012441181eeee56057ec910fba[m
[32m+[m[32mflutter.js,1765511718574,970356511bee637e57348b9e01b3218a3d1d6c4add478fdc306033b4b3e21ef4[m
[32m+[m[32mfavicon.png,1765512246628,19880e004e8357a51f6a64f5d1fdc8828a6432fe9c781f8acb6b730eced2cd13[m
[32m+[m[32micons/Icon-maskable-512.png,1765512246630,ea58e5c49bc4dcdc5db0a9fe2f25b2a3152f85ef9094f0d020de0aa318451a1d[m
[32m+[m[32micons/Icon-maskable-192.png,1765512246629,f7ac56197638aec92f195c5344d15395c2cbf8a5ae74e846c5b4156b64f05e38[m
[32m+[m[32micons/Icon-512.png,1765512246629,1de493563deb283e6ad70f0d5a89cfd61e37343df3b919c9862c5a41699ac5bc[m
[32m+[m[32micons/Icon-192.png,1765512246629,5fd961c51d8eb53baacac01f8e53743a76f66a43390a11f5df042e8c618ad64a[m
[32m+[m[32mcanvaskit/skwasm_heavy.wasm,1765511718496,aa021afcfd815b925d5bad0debf468bef50192c458573e4570d6da4e12c2e186[m
[32m+[m[32mcanvaskit/skwasm_heavy.js.symbols,1765511718450,1259742821cf62bece358301f311840038fc2a0352b0c5827f8d2137d6197d08[m
[32m+[m[32mcanvaskit/skwasm_heavy.js,1765511718439,2e3aab5e61c0276a6704938362b4b3a4dc32bbb6d17d601e975e7ed03897b224[m
[32m+[m[32mcanvaskit/skwasm.wasm,1765511718434,4776f3bfb61a7534e2260954b88b177c11a7c73644cd536c47fcaabe5d7dc79b[m
[32m+[m[32mcanvaskit/skwasm.js.symbols,1765511718402,5d3dd3374664b262880564a3e59d64b150f4c632248fb93f913b4eebdeffca83[m
[32m+[m[32mcanvaskit/skwasm.js,1765511718392,6f325d22924e678a9417a777104985babcee8f99080bf90855f26bfa9829a5ea[m
[32m+[m[32mcanvaskit/canvaskit.wasm,1765511718389,ac942f1920618b74351bc74bf1cf4ca078bde56e11692c0bd611e906bfc2d279[m
[32m+[m[32mcanvaskit/canvaskit.js.symbols,1765511718322,b1e22d35cbc9e3b4b89516a8462c9f1f73d86e6debc790833396dff78ad698a7[m
[32m+[m[32mcanvaskit/canvaskit.js,1765511718312,777116800268972381a4832500bb0aafd96ab2546075bd4d96a9025feb5c7555[m
[32m+[m[32mcanvaskit/chromium/canvaskit.wasm,1765511718563,06f70f0703803c7329be30338b79530564ddc1ab2c3789d608431697a9a30ba2[m
[32m+[m[32mcanvaskit/chromium/canvaskit.js.symbols,1765511718515,4a8d181b0622d7a4b4254deb591c43f48dd89623c621dec6f84d0a0b2b8f77a7[m
[32m+[m[32mcanvaskit/chromium/canvaskit.js,1765511718505,e0f423bfd63202fb53a4dd5cffe330143bfb9eabf5e4e8198bb605442a49d3e7[m
[32m+[m[32mversion.json,1767591937112,e5bb603b44dfc7121a8268c2f03be41315b8e8e094abbe54107d13c5bc766067[m
[32m+[m[32mindex.html,1767591887040,294f81b422409857a226901186e9cc80d6b1656dab850d4d653bb153e4567f69[m
[32m+[m[32massets/FontManifest.json,1767591937239,e38b95988f5d060cf9b7ce97cb5ac9236d6f4cc04a11d69567df97b2b4cbc5e5[m
[32m+[m[32mflutter_bootstrap.js,1767591886984,820902c40056cb4ff7516339aa2f06d07f4ef007b49c6a0904ddb062c530ff01[m
[32m+[m[32massets/AssetManifest.bin.json,1767591937239,6763aaa55146ec9534c671aaf5a6db93265eaaa8082767ea02eb2ac9b09cbdaa[m
[32m+[m[32massets/AssetManifest.bin,1767591937239,93e425eb6f3c87a588cd708f748fc5bb80fa28bf34c6d814b2bd76daa6a6ed27[m
[32m+[m[32mflutter_service_worker.js,1767591941488,a507f1db9873934e0f19a2de64938e7953668ad656bfbd927f28606749ca0a1a[m
[32m+[m[32massets/shaders/stretch_effect.frag,1767591937405,586ff23669838dd33070077916f0b971a8800f67093ae8d6eed47e6cea50926f[m
[32m+[m[32massets/shaders/ink_sparkle.frag,1767591937405,591c7517d5cb43eb91ea451e0d3f9f585cbf8298cf6c46a9144b77cb0775a406[m
[32m+[m[32massets/fonts/MaterialIcons-Regular.otf,1767591938853,90953c746f41b1119c0d750c6118678e481d63e73e355d293f53ba1300f22d6e[m
[32m+[m[32massets/packages/cupertino_icons/assets/CupertinoIcons.ttf,1767591938853,d41473de1f7708a0702d7f19327693486512db442f6ab0cf7774e6d6576f9fcb[m
[32m+[m[32massets/NOTICES,1767591937239,aa2a826f02270c3f4b90c983842da7004f8380949435f2aadb7e3b03a7cad897[m
[32m+[m[32mmain.dart.js,1767591920011,adf58eb5fd17c8e31cd5be6e494786e4473a3a86f83806a56081793379668700[m
[1mdiff --git a/lib/history/main.dart b/lib/history/main.dart[m
[1mindex 569d5ae..6b8c372 100644[m
[1m--- a/lib/history/main.dart[m
[1m+++ b/lib/history/main.dart[m
[36m@@ -1,7 +1,7 @@[m
 import 'package:flutter/material.dart';[m
 import 'package:supabase_flutter/supabase_flutter.dart';[m
 import 'package:flutter_localizations/flutter_localizations.dart';[m
[31m-import 'simulation_screen.dart';[m
[32m+[m[32mimport '../simulation_screen.dart';[m
 import 'history_screen.dart';[m
 import 'quiz_screen.dart';[m
 [m
[1mdiff --git a/lib/history/main_v1.dart b/lib/history/main_v1.dart[m
[1mindex 8a58489..619649b 100644[m
[1m--- a/lib/history/main_v1.dart[m
[1m+++ b/lib/history/main_v1.dart[m
[36m@@ -1,6 +1,6 @@[m
 import 'package:flutter/material.dart';[m
 import 'package:supabase_flutter/supabase_flutter.dart';[m
[31m-import 'simulation_screen.dart';[m
[32m+[m[32mimport '../simulation_screen.dart';[m
 import 'flight_record_screen.dart';[m
 import 'history_screen.dart';[m
 import 'quiz_screen.dart';[m
[1mdiff --git a/lib/history/main_v2.dart b/lib/history/main_v2.dart[m
[1mindex 019fa74..e68847f 100644[m
[1m--- a/lib/history/main_v2.dart[m
[1m+++ b/lib/history/main_v2.dart[m
[36m@@ -1,6 +1,6 @@[m
 import 'package:flutter/material.dart';[m
 import 'package:supabase_flutter/supabase_flutter.dart';[m
[31m-import 'simulation_screen.dart';[m
[32m+[m[32mimport '../simulation_screen.dart';[m
 import 'flight_record_screen.dart';[m
 import 'history_screen.dart';[m
 import 'quiz_screen.dart';[m
[1mdiff --git a/lib/history/simulation_screen.dart b/lib/history/simulation_screen.dart[m
[1mdeleted file mode 100644[m
[1mindex f01b6ed..0000000[m
[1m--- a/lib/history/simulation_screen.dart[m
[1m+++ /dev/null[m
[36m@@ -1,722 +0,0 @@[m
[31m-import 'package:flutter/material.dart';[m
[31m-import 'package:supabase_flutter/supabase_flutter.dart';[m
[31m-import 'dart:convert';[m
[31m-// ignore: avoid_web_libraries_in_flutter[m
[31m-import 'dart:html' as html;[m
[31m-[m
[31m-class SimulationScreen extends StatefulWidget {[m
[31m-  const SimulationScreen({super.key});[m
[31m-[m
[31m-  @override[m
[31m-  State<SimulationScreen> createState() => _SimulationScreenState();[m
[31m-}[m
[31m-[m
[31m-class _SimulationScreenState extends State<SimulationScreen> with AutomaticKeepAliveClientMixin {[m
[31m-  @override[m
[31m-  bool get wantKeepAlive => true;[m
[31m-[m
[31m-  List<Map<String, dynamic>> legs = [];[m
[31m-  [m
[31m-  Map<int, TextEditingController> dateControllers = {};[m
[31m-  Map<int, TextEditingController> flightNumberControllers = {};[m
[31m-  Map<int, TextEditingController> departureTimeControllers = {};[m
[31m-  Map<int, TextEditingController> arrivalTimeControllers = {};[m
[31m-  Map<int, TextEditingController> fareAmountControllers = {};[m
[31m-  [m
[31m-  Map<int, List<Map<String, dynamic>>> availableFlights = {};[m
[31m-  Map<int, List<String>> availableDestinations = {};[m
[31m-  [m
[31m-  int _legIdCounter = 0;[m
[31m-  bool isLoading = false;[m
[31m-  String? errorMessage;[m
[31m-[m
[31m-  String? selectedJALCard;[m
[31m-  String? selectedANACard;[m
[31m-  String? selectedJALStatus;[m
[31m-  String? selectedANAStatus;[m
[31m-  bool jalTourPremium = false; // JALã‚«ãƒ¼ãƒ‰ãƒ„ã‚¢ãƒ¼ãƒ—ãƒ¬ãƒŸã‚¢ãƒ [m
[31m-[m
[31m-  // èˆªç©ºä¼šç¤¾åˆ¥ã®å‡ºç™ºç©ºæ¸¯ãƒªã‚¹ãƒˆï¼ˆå‹•çš„å–å¾—ï¼‰[m
[31m-  List<String> jalDepartureAirports = [];[m
[31m-  List<String> anaDepartureAirports = [];[m
[31m-[m
[31m-  final List<String> jalCardTypes = ['-', 'JMBä¼šå“¡', 'JALã‚«ãƒ¼ãƒ‰æ™®é€šä¼šå“¡', 'JALã‚«ãƒ¼ãƒ‰CLUB-Aä¼šå“¡', 'JALã‚«ãƒ¼ãƒ‰CLUB-Aã‚´ãƒ¼ãƒ«ãƒ‰ä¼šå“¡', 'JALã‚«ãƒ¼ãƒ‰ãƒ—ãƒ©ãƒãƒŠä¼šå“¡', 'JALã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¯ãƒ©ãƒ–ä¼šå“¡(æ—¥æœ¬)', 'JALã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¯ãƒ©ãƒ–ä¼šå“¡(æµ·å¤–)', 'JALã‚«ãƒ¼ãƒ‰NAVIä¼šå“¡', 'JAL CLUB EST æ™®é€šä¼šå“¡', 'JAL CLUB EST CLUB-Aä¼šå“¡', 'JAL CLUB EST CLUB-A GOLDä¼šå“¡', 'JAL CLUB EST ãƒ—ãƒ©ãƒãƒŠä¼šå“¡'];[m
[31m-  final List<String> anaCardTypes = ['-', 'AMCã‚«ãƒ¼ãƒ‰(ææºã‚«ãƒ¼ãƒ‰å«ã‚€)', 'ANAã‚«ãƒ¼ãƒ‰ ä¸€èˆ¬', 'ANAã‚«ãƒ¼ãƒ‰ å­¦ç”Ÿç”¨', 'ANAã‚«ãƒ¼ãƒ‰ ãƒ¯ã‚¤ãƒ‰', 'ANAã‚«ãƒ¼ãƒ‰ ã‚´ãƒ¼ãƒ«ãƒ‰', 'ANAã‚«ãƒ¼ãƒ‰ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ', 'SFC ä¸€èˆ¬', 'SFC ã‚´ãƒ¼ãƒ«ãƒ‰', 'SFC ãƒ—ãƒ¬ãƒŸã‚¢ãƒ '];[m
[31m-  final List<String> jalStatusTypes = ['-', 'JMBãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰', 'JMBã‚µãƒ•ã‚¡ã‚¤ã‚¢', 'JMBã‚¯ãƒªã‚¹ã‚¿ãƒ«'];[m
[31m-  final List<String> anaStatusTypes = ['-', 'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰(1å¹´ç›®)', 'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰(ç¶™ç¶š2å¹´ä»¥ä¸Š)', 'ãƒ—ãƒ©ãƒãƒŠ(1å¹´ç›®)', 'ãƒ—ãƒ©ãƒãƒŠ(ç¶™ç¶š2å¹´ä»¥ä¸Š)', 'ãƒ–ãƒ­ãƒ³ã‚º(1å¹´ç›®)', 'ãƒ–ãƒ­ãƒ³ã‚º(ç¶™ç¶š2å¹´ä»¥ä¸Š)'];[m
[31m-  final List<String> airports = [[m
[31m-    // ä¸»è¦ç©ºæ¸¯[m
[31m-    'HND', 'NRT',  // æ±äº¬[m
[31m-    'ITM', 'KIX', 'UKB',  // å¤§é˜ª[m
[31m-    'CTS', 'OKD',  // æœ­å¹Œ[m
[31m-    'NGO', 'NKM',  // åå¤å±‹[m
[31m-    'FUK',  // ç¦å²¡[m
[31m-    'OKA',  // æ²–ç¸„[m
[31m-    // åŒ—æµ·é“ï¼ˆåŒ—ã‹ã‚‰ï¼‰[m
[31m-    'WKJ', 'MBE', 'MMB', 'SHB', 'KUH', 'OBO', 'AKJ', 'HKD', 'OIR',[m
[31m-    // æ±åŒ—ï¼ˆåŒ—ã‹ã‚‰ï¼‰[m
[31m-    'AOJ', 'MSJ', 'HNA', 'AXT', 'ONJ', 'GAJ', 'SDJ', 'FKS',[m
[31m-    // é–¢æ±ãƒ»ä¸­éƒ¨[m
[31m-    'HAC', 'FSZ', 'MMJ', 'NTQ', 'TOY', 'KMQ', 'SHM',[m
[31m-    // ä¸­å›½ãƒ»å››å›½[m
[31m-    'TTJ', 'YGJ', 'IZO', 'OKJ', 'HIJ', 'IWK', 'UBJ', 'TKS', 'TAK', 'KCZ', 'MYJ',[m
[31m-    // ä¹å·ï¼ˆåŒ—ã‹ã‚‰ï¼‰[m
[31m-    'KKJ', 'HSG', 'NGS', 'KMJ', 'OIT', 'KMI', 'KOJ', 'AXJ',[m
[31m-    // é›¢å³¶[m
[31m-    'IKI', 'TSJ', 'FUJ', 'TNE', 'KUM', 'ASJ', 'KKX', 'TKN', 'OGN', 'MMY', 'ISG', 'RNJ',[m
[31m-  ];[m
[31m-  final Map<String, String> airportNames = {[m
[31m-    'HND': 'ç¾½ç”°', 'NRT': 'æˆç”°', 'KIX': 'é–¢è¥¿', 'ITM': 'ä¼Šä¸¹', 'NGO': 'ä¸­éƒ¨', 'CTS': 'æ–°åƒæ­³', 'FUK': 'ç¦å²¡', 'OKA': 'é‚£è¦‡',[m
[31m-    'NGS': 'é•·å´', 'KMJ': 'ç†Šæœ¬', 'OIT': 'å¤§åˆ†', 'MYJ': 'æ¾å±±', 'HIJ': 'åºƒå³¶', 'TAK': 'é«˜æ¾', 'KCZ': 'é«˜çŸ¥', 'TKS': 'å¾³å³¶', 'KOJ': 'é¹¿å…å³¶',[m
[31m-    'SDJ': 'ä»™å°', 'AOJ': 'é’æ£®', 'AKJ': 'æ—­å·', 'AXT': 'ç§‹ç”°', 'GAJ': 'å±±å½¢', 'KIJ': 'æ–°æ½Ÿ', 'TOY': 'å¯Œå±±', 'KMQ': 'å°æ¾', 'FSZ': 'é™å²¡',[m
[31m-    'MMB': 'å¥³æº€åˆ¥', 'OBO': 'å¸¯åºƒ', 'KUH': 'é‡§è·¯', 'HKD': 'å‡½é¤¨', 'ISG': 'çŸ³å£', 'MMY': 'å®®å¤', 'UBJ': 'å±±å£å®‡éƒ¨', 'IWK': 'å²©å›½',[m
[31m-    'OKJ': 'å²¡å±±', 'TTJ': 'é³¥å–', 'YGJ': 'ç±³å­', 'IZO': 'å‡ºé›²', 'NKM': 'çœŒå–¶åå¤å±‹', 'UKB': 'ç¥æˆ¸', 'HSG': 'ä½è³€', 'KMI': 'å®®å´',[m
[31m-    'ASJ': 'å¥„ç¾', 'TKN': 'å¾³ä¹‹å³¶', 'OKI': 'éš å²', 'FKS': 'ç¦å³¶', 'HNA': 'èŠ±å·»', 'MSJ': 'ä¸‰æ²¢', 'ONJ': 'å¤§é¤¨èƒ½ä»£', 'SHM': 'å—ç´€ç™½æµœ',[m
[31m-    'NTQ': 'èƒ½ç™»', 'KKJ': 'åŒ—ä¹å·', 'TNE': 'ç¨®å­å³¶', 'KUM': 'å±‹ä¹…å³¶', 'RNJ': 'ä¸è«–', 'OGN': 'ä¸é‚£å›½', 'HAC': 'å…«ä¸ˆå³¶',[m
[31m-    'MBE': 'ç´‹åˆ¥', 'SHB': 'ä¸­æ¨™æ´¥', 'WKJ': 'ç¨šå†…', 'OKD': 'ä¸˜ç ', 'IKI': 'å£±å²', 'TSJ': 'å¯¾é¦¬', 'FUJ': 'äº”å³¶ç¦æ±Ÿ', 'OIR': 'å¥¥å°»',[m
[31m-    'SYO': 'åº„å†…', 'MMJ': 'æ¾æœ¬', 'AXJ': 'å¤©è‰', 'TJH': 'ä½†é¦¬', 'KKX': 'å–œç•Œ',[m
[31m-  };[m
[31m-  final List<String> airlines = ['JAL', 'ANA'];[m
[31m-  final Map<String, List<String>> fareTypesByAirline = {[m
[31m-    'JAL': ['é‹è³ƒ1 (100%) ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹ç­‰', 'é‹è³ƒ2 (75%) æ ªä¸»å‰²å¼•', 'é‹è³ƒ3 (75%) ã‚»ã‚¤ãƒãƒ¼', 'é‹è³ƒ4 (75%) ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚»ã‚¤ãƒãƒ¼', 'é‹è³ƒ5 (50%) åŒ…æ‹¬æ—…è¡Œé‹è³ƒ', 'é‹è³ƒ6 (50%) ã‚¹ã‚«ã‚¤ãƒ¡ã‚¤ãƒˆç­‰'],[m
[31m-    'ANA': ['é‹è³ƒ1 (150%) ãƒ—ãƒ¬ãƒŸã‚¢ãƒ é‹è³ƒ', 'é‹è³ƒ2 (125%) ãƒ—ãƒ¬ãƒŸã‚¢ãƒ å°å…', 'é‹è³ƒ3 (100%) ç‰‡é“ãƒ»å¾€å¾©', 'é‹è³ƒ4 (100%) ãƒ“ã‚¸ãƒã‚¹', 'é‹è³ƒ5 (75%) ç‰¹å‰²A', 'é‹è³ƒ6 (75%) ç‰¹å‰²B', 'é‹è³ƒ7 (75%) ç‰¹å‰²C', 'é‹è³ƒ8 (50%) ã„ã£ã—ã‚‡ã«ãƒã‚¤ãƒ«å‰²', 'é‹è³ƒ9 (150%) ãƒ—ãƒ¬ãƒŸã‚¢ãƒ æ ªä¸»', 'é‹è³ƒ10 (100%) æ™®é€šæ ªä¸»', 'é‹è³ƒ11 (70%) ç‰¹å‰²ãƒ—ãƒ©ã‚¹', 'é‹è³ƒ12 (50%) ã‚¹ãƒãƒ¼ãƒˆã‚·ãƒ‹ã‚¢', 'é‹è³ƒ13 (30%) å€‹äººåŒ…æ‹¬'],[m
[31m-  };[m
[31m-  final Map<String, List<String>> seatClassesByAirline = {'JAL': ['æ™®é€šå¸­', 'ã‚¯ãƒ©ã‚¹J', 'ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¯ãƒ©ã‚¹'], 'ANA': ['æ™®é€šå¸­', 'ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚¯ãƒ©ã‚¹']};[m
[31m-[m
[31m-  // JALæ­ä¹—ãƒœãƒ¼ãƒŠã‚¹FOPï¼ˆé‹è³ƒç¨®åˆ¥ã§æ±ºå®šï¼‰[m
[31m-  final Map<String, int> jalBonusFOP = {'é‹è³ƒ1': 400, 'é‹è³ƒ2': 400, 'é‹è³ƒ3': 200, 'é‹è³ƒ4': 200, 'é‹è³ƒ5': 0, 'é‹è³ƒ6': 0};[m
[31m-  [m
[31m-  // ANAæ­ä¹—ãƒã‚¤ãƒ³ãƒˆï¼ˆé‹è³ƒç¨®åˆ¥ã§æ±ºå®šï¼‰[m
[31m-  final Map<String, int> anaBonusPoint = {'é‹è³ƒ1': 400, 'é‹è³ƒ2': 400, 'é‹è³ƒ3': 400, 'é‹è³ƒ4': 0, 'é‹è³ƒ5': 400, 'é‹è³ƒ6': 200, 'é‹è³ƒ7': 0, 'é‹è³ƒ8': 0, 'é‹è³ƒ9': 0, 'é‹è³ƒ10': 0, 'é‹è³ƒ11': 0, 'é‹è³ƒ12': 0, 'é‹è³ƒ13': 0};[m
[31m-[m
[31m-  @override[m
[31m-  void initState() { super.initState(); _addLeg(); _loadAirlineAirports(); }[m
[31m-[m
[31m-  Future<void> _loadAirlineAirports() async {[m
[31m-    try {[m
[31m-      // JALã®å‡ºç™ºç©ºæ¸¯ã‚’å–å¾—[m
[31m-      final jalResponse = await Supabase.instance.client[m
[31m-          .from('schedules')[m
[31m-          .select('departure_code')[m
[31m-          .eq('airline_code', 'JAL')[m
[31m-          .eq('is_active', true);[m
[31m-      final jalAirports = (jalResponse as List)[m
[31m-          .map((e) => e['departure_code'] as String)[m
[31m-          .where((code) => airportNames.containsKey(code))[m
[31m-          .toSet()[m
[31m-          .toList();[m
[31m-      jalAirports.sort();[m
[31m-[m
[31m-      // ANAã®å‡ºç™ºç©ºæ¸¯ã‚’å–å¾—[m
[31m-      final anaResponse = await Supabase.instance.client[m
[31m-          .from('schedules')[m
[31m-          .select('departure_code')[m
[31m-          .eq('airline_code', 'ANA')[m
[31m-          .eq('is_active', true);[m
[31m-      final anaAirports = (anaResponse as List)[m
[31m-          .map((e) => e['departure_code'] as String)[m
[31m-          .where((code) => airportNames.containsKey(code))[m
[31m-          .toSet()[m
[31m-          .toList();[m
[31m-      anaAirports.sort();[m
[31m-[m
[31m-      setState(() {[m
[31m-        jalDepartureAirports = jalAirports;[m
[31m-        anaDepartureAirports = anaAirports;[m
[31m-      });[m
[31m-    } catch (e) {[m
[31m-      // ã‚¨ãƒ©ãƒ¼æ™‚ã¯airportsãƒªã‚¹ãƒˆã‚’ãã®ã¾ã¾ä½¿ç”¨[m
[31m-      setState(() {[m
[31m-        jalDepartureAirports = airports;[m
[31m-        anaDepartureAirports = airports;[m
[31m-      });[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  @override[m
[31m-  void dispose() {[m
[31m-    dateControllers.values.forEach((c) => c.dispose());[m
[31m-    flightNumberControllers.values.forEach((c) => c.dispose());[m
[31m-    departureTimeControllers.values.forEach((c) => c.dispose());[m
[31m-    arrivalTimeControllers.values.forEach((c) => c.dispose());[m
[31m-    fareAmountControllers.values.forEach((c) => c.dispose());[m
[31m-    super.dispose();[m
[31m-  }[m
[31m-[m
[31m-  void _addLeg() {[m
[31m-    final legId = _legIdCounter++;[m
[31m-    dateControllers[legId] = TextEditingController();[m
[31m-    flightNumberControllers[legId] = TextEditingController();[m
[31m-    departureTimeControllers[legId] = TextEditingController();[m
[31m-    arrivalTimeControllers[legId] = TextEditingController();[m
[31m-    fareAmountControllers[legId] = TextEditingController();[m
[31m-    String airline = 'JAL'; String departureAirport = ''; String arrivalAirport = ''; String date = '';[m
[31m-    if (legs.isNotEmpty) {[m
[31m-      final prevLeg = legs.last; final prevLegId = prevLeg['id'] as int;[m
[31m-      airline = prevLeg['airline'] as String;[m
[31m-      departureAirport = prevLeg['arrivalAirport'] as String;[m
[31m-      arrivalAirport = prevLeg['departureAirport'] as String;[m
[31m-      date = dateControllers[prevLegId]?.text ?? '';[m
[31m-    }[m
[31m-    dateControllers[legId]?.text = date;[m
[31m-    setState(() { legs.add({'id': legId, 'airline': airline, 'departureAirport': departureAirport, 'arrivalAirport': arrivalAirport, 'fareType': '', 'seatClass': '', 'calculatedFOP': null, 'calculatedMiles': null}); });[m
[31m-    if (departureAirport.isNotEmpty) _fetchAvailableFlights(legs.length - 1);[m
[31m-  }[m
[31m-[m
[31m-  void _removeLeg(int index) {[m
[31m-    final legId = legs[index]['id'] as int;[m
[31m-    dateControllers[legId]?.dispose(); flightNumberControllers[legId]?.dispose(); departureTimeControllers[legId]?.dispose(); arrivalTimeControllers[legId]?.dispose(); fareAmountControllers[legId]?.dispose();[m
[31m-    dateControllers.remove(legId); flightNumberControllers.remove(legId); departureTimeControllers.remove(legId); arrivalTimeControllers.remove(legId); fareAmountControllers.remove(legId);[m
[31m-    availableFlights.remove(legId); availableDestinations.remove(legId);[m
[31m-    setState(() => legs.removeAt(index));[m
[31m-  }[m
[31m-[m
[31m-  void _clearFlightInfo(int index, int legId) {[m
[31m-    setState(() { legs[index]['departureAirport'] = ''; legs[index]['arrivalAirport'] = ''; legs[index]['calculatedFOP'] = null; legs[index]['calculatedMiles'] = null; availableFlights[legId] = []; availableDestinations[legId] = []; });[m
[31m-    flightNumberControllers[legId]?.text = ''; departureTimeControllers[legId]?.text = ''; arrivalTimeControllers[legId]?.text = '';[m
[31m-  }[m
[31m-[m
[31m-  void _clearLeg(int index, int legId) {[m
[31m-    _clearFlightInfo(index, legId);[m
[31m-    setState(() { legs[index]['fareType'] = ''; legs[index]['seatClass'] = ''; });[m
[31m-    dateControllers[legId]?.text = ''; fareAmountControllers[legId]?.text = '';[m
[31m-  }[m
[31m-[m
[31m-  String _addMinutes(String time, int minutes) {[m
[31m-    if (time.isEmpty || !time.contains(':')) return time;[m
[31m-    final parts = time.split(':'); int hour = int.tryParse(parts[0]) ?? 0; int min = int.tryParse(parts[1]) ?? 0;[m
[31m-    min += minutes; while (min >= 60) { min -= 60; hour += 1; } if (hour >= 24) hour -= 24;[m
[31m-    return '${hour.toString().padLeft(2, '0')}:${min.toString().padLeft(2, '0')}';[m
[31m-  }[m
[31m-[m
[31m-  bool _isTimeAfterOrEqual(String time1, String time2) {[m
[31m-    if (time1.isEmpty || time2.isEmpty || !time1.contains(':') || !time2.contains(':')) return true;[m
[31m-    final parts1 = time1.split(':'); final parts2 = time2.split(':');[m
[31m-    final minutes1 = (int.tryParse(parts1[0]) ?? 0) * 60 + (int.tryParse(parts1[1]) ?? 0);[m
[31m-    final minutes2 = (int.tryParse(parts2[0]) ?? 0) * 60 + (int.tryParse(parts2[1]) ?? 0);[m
[31m-    return minutes1 >= minutes2;[m
[31m-  }[m
[31m-[m
[31m-  Future<Map<String, dynamic>?> _fetchScheduleByFlightNumber(String airline, String flightNumber) async {[m
[31m-    try { return await Supabase.instance.client.from('schedules').select().eq('airline_code', airline).eq('flight_number', flightNumber).eq('is_active', true).maybeSingle(); } catch (e) { return null; }[m
[31m-  }[m
[31m-[m
[31m-  Future<void> _autoFillFromFlightNumber(int index) async {[m
[31m-    final legId = legs[index]['id'] as int;[m
[31m-    final airline = legs[index]['airline'] as String;[m
[31m-    final flightNumber = flightNumberControllers[legId]?.text ?? '';[m
[31m-    if (flightNumber.isEmpty) { setState(() => errorMessage = 'ä¾¿åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }[m
[31m-    final schedule = await _fetchScheduleByFlightNumber(airline, flightNumber);[m
[31m-    if (schedule != null) {[m
[31m-      String depTime = schedule['departure_time'] ?? ''; String arrTime = schedule['arrival_time'] ?? '';[m
[31m-      if (depTime.length > 5) depTime = depTime.substring(0, 5); if (arrTime.length > 5) arrTime = arrTime.substring(0, 5);[m
[31m-      final depCode = schedule['departure_code'] as String; final arrCode = schedule['arrival_code'] as String;[m
[31m-      setState(() { legs[index]['departureAirport'] = depCode; legs[index]['arrivalAirport'] = arrCode; errorMessage = null; });[m
[31m-      departureTimeControllers[legId]?.text = depTime; arrivalTimeControllers[legId]?.text = arrTime;[m
[31m-      await _fetchAvailableFlights(index);[m
[31m-      if (index + 1 < legs.length) _fetchAvailableFlights(index + 1);[m
[31m-      _calculateSingleLeg(index);[m
[31m-    } else { setState(() => errorMessage = '$flightNumberä¾¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'); }[m
[31m-  }[m
[31m-[m
[31m-  Future<void> _fetchAvailableFlights(int index) async {[m
[31m-    final leg = legs[index]; final legId = leg['id'] as int; final airline = leg['airline'] as String;[m
[31m-    final departure = leg['departureAirport'] as String; final arrival = leg['arrivalAirport'] as String;[m
[31m-    if (departure.isEmpty) { setState(() { availableFlights[legId] = []; availableDestinations[legId] =